<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Water Ring Toss Game</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
      background-color: #f0f0f0;
      font-family: Arial, sans-serif;
    }
    canvas {
      border: 2px solid #333;
      background-color: #87CEEB;
    }
    .button-container {
      display: flex;
      gap: 20px;
      margin-top: 10px;
      position: absolute;
      bottom: 20px;
    }
    button {
      width: 60px;
      height: 60px;
      font-size: 14px;
      cursor: pointer;
      background-color: #ff4500;
      color: white;
      border: none;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 0;
    }
    button:hover {
      background-color: #ff6347;
    }
    p {
      font-size: 18px;
      color: #333;
      margin-top: 10px;
    }
    #playAgainButton {
      display: none;
      background-color: #4CAF50;
      position: absolute;
      top: 20px;
      width: auto;
      height: auto;
      padding: 10px 20px;
      border-radius: 5px;
      font-size: 16px;
    }
    #playAgainButton:hover {
      background-color: #45a049;
    }
  </style>
</head>
<body>
  <button id="playAgainButton">Play Again</button>
  <div class="button-container">
    <button id="pushLeftButton">Push<br>Left</button>
    <button id="pushRightButton">Push<br>Right</button>
  </div>
  <p>Use arrow keys or device tilt for left/right, click buttons to make rings fly to the peg! On mobile, tilt your device.</p>
  <script>
    let rings = [];
    let peg;
    let leftWaterForce = 0;
    let rightWaterForce = 0;
    let tiltAngle = 0;
    let ringsOnPeg = 0;
    const numRings = 5;
    let gameWon = false;
    let bubbles = [];

    class Bubble {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.radius = random(2, 5);
        this.vy = random(-1, -0.5);
      }

      update() {
        this.y += this.vy;
        if (this.y < 50) this.y = height - 50; // Reset to bottom
      }

      display() {
        noStroke();
        fill(255, 255, 255, 150);
        ellipse(this.x, this.y, this.radius * 2);
      }
    }

    class Ring {
      constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.vx = 0;
        this.vy = 0;
        this.color = color;
        this.onPeg = false;
        this.radius = 15;
      }

      update() {
        if (!this.onPeg && !gameWon) {
          // Simulate buoyancy and water push
          this.vy += 0.05; // Reduced gravity for floatier feel
          this.vy -= (leftWaterForce + rightWaterForce) * 0.1; // Stronger upward push for all rings
          this.vx += leftWaterForce * -0.05; // Stronger left push for all rings
          this.vx += rightWaterForce * 0.05; // Stronger right push for all rings
          this.vy *= 0.98; // Reduced damping for smoother motion
          this.vx *= 0.98; // Reduced damping for smoother motion
          this.y += this.vy;
          this.x += this.vx;
          // Simulate tilt
          this.x += tiltAngle * 0.7;
          // Boundaries
          if (this.y < 50) this.y = 50;
          if (this.y > height - 50) this.y = height - 50;
          if (this.x < 50) this.x = 50;
          if (this.x > width - 50) this.x = width - 50;
          // Check if ring lands on peg
          if (Math.abs(this.x - peg.x) < 15 && Math.abs(this.y - peg.y) < 15 && !this.onPeg) {
            console.log('Ring landed on peg:', ringsOnPeg + 1);
            this.onPeg = true;
            this.x = peg.x;
            this.y = peg.y - ringsOnPeg * 10 - 20;
            this.vx = 0;
            this.vy = 0;
            ringsOnPeg++;
          }
        }
      }

      display() {
        noFill();
        stroke(this.color);
        strokeWeight(4);
        ellipse(this.x, this.y, this.radius * 2);
        strokeWeight(2);
        ellipse(this.x, this.y, this.radius * 1.5);
      }
    }

    class Peg {
      constructor(x, y) {
        this.x = x;
        this.y = y;
      }

      display() {
        fill(139, 69, 19);
        stroke(100, 50, 10);
        strokeWeight(1);
        rect(this.x - 7, this.y - 60, 14, 120, 5);
      }
    }

    function resetGame() {
      rings = [];
      ringsOnPeg = 0;
      gameWon = false;
      for (let i = 0; i < numRings; i++) {
        let x = random(50, width - 50);
        let y = random(height - 100, height - 50);
        let colors = ['#FF0000', '#00FF00', '#0000FF', '#FFFF00', '#FF00FF'];
        rings.push(new Ring(x, y, colors[i]));
      }
      document.getElementById('playAgainButton').style.display = 'none';
    }

    function setup() {
      let canvasSize = min(windowWidth * 0.8, 300);
      let canvasHeight = min(windowHeight * 0.6, 400);
      createCanvas(canvasSize, canvasHeight);
      resetGame();
      peg = new Peg(width / 2, height / 2 + 20);
      // Button events
      const leftButton = document.getElementById('pushLeftButton');
      const rightButton = document.getElementById('pushRightButton');
      const playAgainButton = document.getElementById('playAgainButton');
      leftButton.addEventListener('click', () => {
        if (!gameWon) {
          console.log('Left button clicked');
          leftWaterForce = 1.5;
          for (let i = 0; i < 5; i++) {
            bubbles.push(new Bubble(random(50, 150), height - 50));
          }
        }
      });
      rightButton.addEventListener('click', () => {
        if (!gameWon) {
          console.log('Right button clicked');
          rightWaterForce = 1.5;
          for (let i = 0; i < 5; i++) {
            bubbles.push(new Bubble(random(150, 250), height - 50));
          }
        }
      });
      playAgainButton.addEventListener('click', () => {
        console.log('Play Again clicked');
        resetGame();
      });
      // Mobile tilt support
      if (window.DeviceOrientationEvent) {
        window.addEventListener('deviceorientation', handleOrientation);
      }
    }

    function handleOrientation(event) {
      tiltAngle = map(event.gamma, -30, 30, -2, 2);
      tiltAngle = constrain(tiltAngle, -2, 2);
    }

    function windowResized() {
      let canvasSize = min(windowWidth * 0.8, 300);
      let canvasHeight = min(windowHeight * 0.6, 400);
      resizeCanvas(canvasSize, canvasHeight);
      peg.x = width / 2;
      peg.y = height / 2 + 20;
    }

    function draw() {
      let gradient = drawingContext.createLinearGradient(0, 0, 0, height);
      gradient.addColorStop(0, '#87CEEB');
      gradient.addColorStop(1, '#4682B4');
      drawingContext.fillStyle = gradient;
      rect(0, 0, width, height);

      stroke(0);
      strokeWeight(2);
      noFill();
      rect(25, 25, width - 50, height - 50);

      for (let i = bubbles.length - 1; i >= 0; i--) {
        bubbles[i].update();
        bubbles[i].display();
        if (bubbles[i].y < 50) bubbles.splice(i, 1);
      }

      for (let ring of rings) {
        ring.update();
        ring.display();
      }
      peg.display();

      leftWaterForce *= 0.9;
      rightWaterForce *= 0.9;

      if (keyIsDown(LEFT_ARROW)) {
        tiltAngle = -1;
      } else if (keyIsDown(RIGHT_ARROW)) {
        tiltAngle = 1;
      } else if (Math.abs(tiltAngle) < 0.1) {
        tiltAngle = 0;
      } else {
        tiltAngle *= 0.9;
      }

      if (ringsOnPeg === numRings && !gameWon) {
        gameWon = true;
        textSize(32);
        fill(255, 215, 0);
        textAlign(CENTER);
        text('You Win!', width / 2, 40);
        document.getElementById('playAgainButton').style.display = 'block';
      }
    }
  </script>
</body>
</html>